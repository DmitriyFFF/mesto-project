(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e){"Escape"===e.key&&x(document.querySelector(".popup_opened"))}function n(e){(e.target.classList.contains("popup__close")||e.target.classList.contains("popup_opened"))&&x(e.currentTarget)}function r(e,t,n){e.textContent=n?"Сохранение...":t}function o(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function c(e,t,n){t.textContent=e.likes.length,n.classList.toggle("card__button_active")}e.d({},{xS:()=>B});var a=document.querySelector(".form_type_profile"),i=document.querySelector(".elements__gallery"),u=document.querySelector(".form_type_cards"),l=u.querySelector(".form__input_type_url"),s=u.querySelector(".form__input_type_place"),d=u.querySelector(".form__button"),f=document.querySelector(".profile__name"),p=document.querySelector(".profile__description"),m=document.querySelector(".form_type_avatar"),y=m.querySelector(".form__input_type_avatar"),_=m.querySelector(".form__button"),v=document.querySelector(".profile__avatar"),h=document.querySelector(".profile__avatar-edit"),b=a.querySelector(".form__input_type_name"),S=a.querySelector(".form__input_type_about"),q=a.querySelector(".form__button"),g=document.querySelector(".popup_type_profile"),E=document.querySelector(".popup_type_gallery"),L=document.querySelector(".popup_type_avatar"),C=document.querySelector(".profile__edit-button"),k=document.querySelector(".profile__add-card-button");function A(e){e.classList.add("popup_opened"),document.addEventListener("keydown",t),e.addEventListener("click",n)}function x(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",t),e.removeEventListener("click",n)}function w(e){e.disabled=!0}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}C.addEventListener("click",(function(){A(g),b.value=f.textContent,S.value=p.textContent})),k.addEventListener("click",(function(){A(E)})),h.addEventListener("click",(function(){A(L)})),v.addEventListener("mouseover",(function(){h.style.display="block"})),v.addEventListener("mouseout",(function(){h.style.display="none"}));var U=document.querySelector("#card-template").content,j=document.querySelector(".popup_type_photo"),O=j.querySelector(".popup__image"),P=j.querySelector(".popup__image-name");function D(e,t,n,r,o,c,a,i,u){var l;(function(e){if(Array.isArray(e))return e})(l=o)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(l)||function(e,t){if(e){if("string"==typeof e)return T(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?T(e,t):void 0}}(l)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}();var s=U.querySelector(".card").cloneNode(!0),d=s.querySelector(".card__image"),f=s.querySelector(".card__delete-button"),p=s.querySelector(".card__button"),m=s.querySelector(".card__like-counter");return d.src=e,d.alt=t,s.querySelector(".card__place").textContent=t,m.textContent=n.length,n.some((function(e){return e._id==B}))&&p.classList.add("card__button_active"),p.addEventListener("click",(function(e){e.preventDefault(),p.classList.contains("card__button_active")?i(c,m,p):a(c,m,p)})),r===B?(f.classList.remove("card__delete-button_disabled"),f.addEventListener("click",(function(){u(c,s)}))):f.classList.add("card__delete-button_disabled"),d.addEventListener("click",(function(){O.src=e,P.textContent=t,O.alt=t,A(j)})),s}function I(e,t){e.prepend(t)}var M={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__button",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"};function N(e,t,n){var r=Array.from(e.querySelectorAll(t)),o=e.querySelector(n);J(r,o),r.forEach((function(t){t.addEventListener("input",(function(){!function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n),o.classList.remove(r),o.textContent=""}(e,t,M.inputErrorClass,M.errorClass):function(e,t,n,r,o){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r),c.textContent=n,c.classList.add(o)}(e,t,t.validationMessage,M.inputErrorClass,M.errorClass)}(e,t),J(r,o)}))}))}function J(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.removeAttribute("disabled"):t.setAttribute("disabled",!0)}var B,G={baseUrl:"https://nomoreparties.co/v1/plus-cohort-14",headers:{authorization:"1a1c4ff3-29e4-400a-a3cb-d6bec25bd6e2","Content-Type":"application/json"}};function H(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var V={name:f,description:p,avatar:v};function $(e,t,n){(function(e){return fetch("".concat(G.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:G.headers}).then(o)})(e).then((function(e){c(e,t,n)})).catch((function(e){console.log(e)}))}function z(e,t,n){(function(e){return fetch("".concat(G.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:G.headers}).then(o)})(e).then((function(e){c(e,t,n)})).catch((function(e){console.log(e)}))}function F(e,t){(function(e){return fetch("".concat(G.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:G.headers}).then(o)})(e).then((function(){t.remove()})).catch((function(e){console.log(e)}))}function K(e,t){e.name.textContent=t.name,e.description.textContent=t.about,e.avatar.src=t.avatar}Promise.all([fetch("".concat(G.baseUrl,"/users/me"),{method:"GET",headers:G.headers}).then(o),fetch("".concat(G.baseUrl,"/cards"),{method:"GET",headers:G.headers}).then(o)]).then((function(e){var t,n,r=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c=[],a=!0,i=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(c.push(r.value),!t||c.length!==t);a=!0);}catch(e){i=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(i)throw o}}return c}}(t,n)||function(e,t){if(e){if("string"==typeof e)return H(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?H(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],c=r[1];K(V,o),B=o._id,c.forEach((function(e){I(i,D(e.link,e.name,e.likes,e.owner._id,[],e._id,$,z,F))}))})).catch((function(e){console.log(e)})),a.addEventListener("submit",(function(e){var t,n;e.preventDefault(),r(q,"Сохранить",!0),(t=b,n=S,fetch("".concat(G.baseUrl,"/users/me"),{method:"PATCH",headers:G.headers,body:JSON.stringify({name:t.value,about:n.value})}).then(o)).then((function(e){K(V,e),w(q),x(g)})).catch((function(e){console.log(e)})).finally((function(){r(q,"Сохранить",!1)}))})),u.addEventListener("submit",(function(e){var t,n;e.preventDefault(),r(d,"Создать",!0),(t=l,n=s,fetch("".concat(G.baseUrl,"/cards"),{method:"POST",headers:G.headers,body:JSON.stringify({name:n.value,link:t.value})}).then(o)).then((function(e){I(i,D(e.link,e.name,e.likes,e.owner._id,[],e._id,$,z,F)),u.reset(),w(d),x(E)})).catch((function(e){console.log(e)})).finally((function(){r(d,"Создать",!1)}))})),m.addEventListener("submit",(function(e){e.preventDefault(),r(_,"Сохранить",!0),function(e){return fetch("".concat(G.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:G.headers,body:JSON.stringify({avatar:"".concat(e.value)})}).then(o)}(y).then((function(e){K(V,e),m.reset(),w(_),x(L)})).catch((function(e){console.log(e)})).finally((function(){r(_,"Сохранить",!1)}))})),function(e){document.querySelectorAll(e.formSelector).forEach((function(t){N(t,e.inputSelector,e.submitButtonSelector)}))}(M)})();